# 4.1.10 트랜잭션 지원 메타데이터

## 데이터베이스 깨짐 현상

예전 mysql은 테이블의 구조를 FRM 파일에 저장하고 스토어드 프로그램 또한 파일 기반으로 관리했다.

파일은 트랜잭션을 지원하지 않기 때문에, 테이블의 생성 또는 변경 도중에 mysql 서버가 비정상 종료되면 파일이 망가졌다.

이러한 현상을 가리켜 "데이터베이스, 테이블이 깨졌다" 라고 표현한다.

## 깨짐 현상 개선

Mysql 8.0 부터는 이러한 문제점을 해결하기 위해 이러한 정보를 모두 InnoDB의 테이블에 저장한다.

중요한 테이블들을 묶어서 시스템 테이블이라고 하는데, mysql.ibd 라는 이름으로 저장한다.

> *.ibd 파일은 취급에 유의하자.

디비 테이블에 저장하기 때문에 트랜잭션을 제공한다. *데이터베이스가 깨지지 않는다*.

### MyISAM이나 CSV 스토리지 엔진은?

InnoDB를 사용하는 테이블은 해결되었지만, MyISAM이나 CSV 스토리지 엔진을 사용하는 테이블은 어떨까?
여전히 SDI 파일에 저장한다. SDI 파일은 FRM 파일과 동일한 역할을 한다.

Q. 여전히 테이블이 깨질 수 있는가?

아마도...?

## ibd와 sdi의 상호 호환성?

SDI, IBD 둘 다 데이터 직렬화를 위한 저장 포맷이므로 IBD -> SDI로 변환 가능하다.
JSON으로도 가능하다.

```bash
ibd2sdi mysql_data_dir/mysql.ibd > mysql_schema.json
```
