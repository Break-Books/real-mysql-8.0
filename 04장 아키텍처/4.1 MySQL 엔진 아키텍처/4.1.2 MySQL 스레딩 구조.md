# 4.1.2 MySQL 스레딩 구조

![](https://velog.velcdn.com/images/hellojihyoung/post/a2474fbb-7ad5-4ce2-bb75-988d5428c12f/image.png)

MySQL 서버는 프로세스 기반이 아닌 스레드 기반으로 동작, `포그라운드`와 `백그라운드`로 구분할 수 있다.

> 스레드의 목록 확인 → performance_schema 데이터베이스의 threads 테이블

- 백그라운드 스레드의 갯수는 MySQL 서버의 설정 내용에 따라 가변적
- 동일한 이름의 스레드가 2개 이상씩 보이는 것은 설정 내용에 따라 스레드가 동일 작업을 병렬로 처리하는 경우를 의미

<br>

## 포그라운드 스레드 (클라이언트 스레드)
### 특징
- 최소한 MySQL 서버에 접속된 클라이언트의 수만큼 존재
- 주로 각 클라이언트 사용자가 요청하는 쿼리 문장을 처리
- 작업을 마치고 커넥션을 종료하면 커넥션을 담당하던 스레드는 다시 스레드 캐시로 복귀
  - 이때 스레드 캐시에 일정 개수 이상의 대기중인 스레드가 있으면 캐시에 넣지않고 스레드를 종료
    - 스레드 캐시에 유지할 수 있는 최대 스레드 개수 : thread_cache_size

<br>

MyISAM - 디스크 쓰기 작업까지 포그라운드 스레드가 처리

InnoDB - 데이터 버퍼나 캐시까지만 포그라운드 스레드가 처리

<br>

## 백그라운드 스레드

MyISAM 경우에는 별로 해당 사항이 없지만 InnoDB는 여러가지 작업을 백그라운드로 처리한다.

- 인서트 버퍼를 병합하는 스레드
- **로그를 디스크로 기록하는 스레드**
- **InnoDB 버퍼 풀의 데이터를 디스크에 기록하는 스레드**
- 데이터를 버퍼로 읽어 오는 스레드
- 잠금이나 데드락을 모니터링하는 스레드
  
  MySQL 5.5 버전부터 데이터 쓰기 스레드와 읽기 스레드의 개수를 2개 이상 지정할 수 있게 됐으며, 아래 변수로 스레드의 개수를 설정할 수 있다.
  - 데이터 쓰기 스레드 시스템 변수 : innodb_write_io_threads
  - 데이터 읽기 쓰레드 시스템 변수 : innodb_read_io_threads


InnoDB에서 **쓰기 스레드는 많은 작업을 백그라운드로 처리**하므로 일반적인 디스크를 사용할 때는 2~4 정도, DAS, SAN 같은 스토리지를 사용하면 충분히 설정하는 것이 좋다.

사용자 요청을 처리할 때 쓰기 작업은 버퍼링되어 처리할 수 있으나 **읽기 작업은 지연될 수 없다.** 
일반 DBMS는 쓰기 작업을 버퍼링해서 일괄 처리하는 기능이 탑재되어 있고 InnoDB 또한 그렇다. 하지만 MyISAM 은 그렇지 않고 포그라운드 스레드가 쓰기 직업까지 함께 처리한다.