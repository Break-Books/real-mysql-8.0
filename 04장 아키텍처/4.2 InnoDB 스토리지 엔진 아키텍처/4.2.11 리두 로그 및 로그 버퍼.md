# 4.2.11 리두 로그 및 로그 버퍼

![](https://velog.velcdn.com/images/younghyun-na/post/42663796-1516-4ecd-99d6-d1b03adc73e3/image.png)

리두로그는 서버가 비정상적으로 종료됐을 때 트랜잭션에 의해 변경된 데이터를 적용하기 위해서 사용한다.

이것을 통해서 작업 순서에 맞게 복구를 할 수 있다.

1. 커밋됐지만 데이터 파일에 기록되지 않은 데이터의 경우,
   리두 로그에 저장된 데이터를 데이터 파일에 복사하면 된다.

2. 롤백됐지만 데이터 파일에 이미 기록된 데이터의 경우,
   언두 로그에 저장된 데이터를 데이터 파일에 복사하면 된다. 이 때 변경 상태에 대해서 알기 위해 리두 로그가 필요하다.

리두 로그는 순환하면서 기존의 데이터를 계속 덮어 씌우기 때문에 트랜잭션이 커밋되면 즉시 리두 로그를 디스크에 기록하는 것을 권장한다.

+ innodb_flush_log_at_trx_commit 파라미터의 설정값에 따라 언제 메모리에서 디스크 리두 로그가 기록되는지 설정할 수 있다.

InnoDB 스토리지 엔진의 리두 로그 파일들의 전체 크기는 버퍼 풀의 효율성을 결정하기 때문에 신중히 결정해야 한다.
## 4.2.11.2 리두 로그 활성화 및 비활성화

MySQL 8.0 버전부터는 리두 로그를 수동으로 활성화하거나 비활성화할 수 있게 됐다. 그래서 데이터를 복구하거나 대용량 데이터를 한 번에 적재하는 경우 리두 로그를 비활성화해 데이터 적재 시간을 줄일 수 있다.

```sql
// 리두 로그 비활성화
ALTER INSTANCE DISABLE INNODB REDO_LOG;

// 리두 로그 활성화
ALTER INSTANCE ENABLE INNODB REDO_LOG;
```

- `Innodb_redo_log_enabled` 상태 변수를 통해 리두 로그 활성화 여부 확인 가능

<br>

리두 로그 비활성화 이후 데이터 적재 작업 실행 시 적재 완료 후 리두 로그 재활성화를 해줘야한다.
  - 비정상 종료 시 
    - 체크포인트 이후 시점의 데이터 복구 불가능
    - 체크포인트 시점의 상태가 비일관될 수 있음

<br>

> MySQL 서버는 새롭게 시작 될 때 리두 로그에서 데이터 파일에 기록되지 못한 데이터가 있는지 검사를 하게 된다. 이때 리두 로그가 비활성화된 상태로 비정상 종료가 됐다면, 리두 로그를 통한 복구가 불가능하기 때문에 정상 시작이 불가능하다.
> 
>  이 경우 innodb_force_recovery 값을 6으로 설정하여 다시 시작한다.