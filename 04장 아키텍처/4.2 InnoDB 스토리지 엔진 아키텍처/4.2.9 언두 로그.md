# 언두로그 

InnoDB 스토리지 엔진은 트래잭션과 격리 수준을 보장하기 위해 DML(INSERT, UPDATE, DELETE)로 변경되기 이전 버전의 데이터를 별도로 백업한다.
이렇게 백업된 데이터를 `언두로그`라고 한다.

## 언두 로그 레코드 모니터링

언두 영역은 `INSERT, UPDATE, DELET` 같은 문장으로 데이터를 변경 했을때 변경되기 전의 데이터를 보관하는 곳이다.

### 언두로그의 데이터의 용도
1. 트랜잭션의 롤백 대비.
2. 트랜잭션의 격리 수준 유지 및 높은 동시성 제공

MySQL 5.5 버전에서는 언두로그가 사용 공간이 늘어가데 되면 MySQL서버를 새로 구축하지 않는 한 줄일 방도가 없었다. 하지만 MySQL 5.7, MySQL 8.0 으로 업그레이드 되면서 언두로그를 순차적으로 사용해 용량을 줄이거나, MySQL 서버가 필요한 시점에 사용공간을 자동으로 줄여 주기도 한다.

```
mysql> SHOW ENGINE INNODB STATUS \G
# 명령어를 통해 언두로그의 레코드 건수를 조회 할 수 있다.

mysql> SELECT count FROM information_schema.innodb_metrics WHERE SUBSYSTEM='transaction' AND NAME ='trx_rseg_history_len';
# MySQL 8.0 버전에서 사용가능 한 명령.
```

MySQL에서 `Insert, Update, DELETE`의 횟수에 따라 언두 로그의 존재하는 레코드 건수는 다를 수 있으며, 서버별로 안정적인 시점에 언두 로그의 레코드 건수를 확인하여 이를 기준으로 모니터링하는 것이 좋다.