# 8.3.4 B-Tree 인덱스를 통한 데이터 읽기

해당 장에서는 MySQL이 인덱스를 이용하는 방법 3가지에 대해 설명한다.

<br>

## 8.3.4.1 인덱스 레인지 스캔
인덱스 레인지 스캔은 검색해야 할 인덱스의 범위가 결정됐을 때 사용하는 방식이다.

![](https://velog.velcdn.com/images/hellojihyoung/post/650293f9-1935-4ee8-b92d-82f22a2e1f11/image.png)

### 인덱스 레인지 스캔 순서
1. 루트 노드에서부터 비교를 시작해 브랜치 노드를 거치고 리프 노드까지 찾아가 레코드의 시작 지점을 찾는다.
2. 시작 지점부터 순서대로 레코드를 읽는다.
3. 페이지의 끝까지 읽으면 리프 노드간의 링크(Linked list)를 이용해 다음 리프 노드를 찾아서 다시 스캔한다.
4. 최종적으로 레코드를 끝까지 읽으면 사용자에게 반환한다.

**인덱스 자체 정렬 특성으로 인해 인덱스를 구성하는 컬럼은 항상 정렬된 상태로 레코드를 가져온다.**

### 인덱스 레인지 스캔으로 레코드 읽기
인덱스의 리프 노드에서 검색 조건에 일치하는 건들은 데이터 파일에서 레코드를 읽어오는 과정은 다음과 같다.

![](https://velog.velcdn.com/images/hellojihyoung/post/cae69153-ce69-47f9-85ea-f57594d618fb/image.png)

1. 인덱스 조건을 만족하는 값이 저장된 위치를 찾는다. (Index seek, 인덱스 탐색)
2. 탐색된 위치부터 필요한 만큼 인덱스를 차례대로 쭉 읽는다. (Index scan, 인덱스 스캔)
3. 읽은 인덱스 키와 레코드 주소를 이용해 레코드가 저장된 페이지를 가져오고 최종 레코드를 읽어온다.
    - 해당 과정은 쿼리가 필요로 하는 데이터에 따라 불필요할 수 있음 : 커버링 인덱스
    - 커버링 인덱스로 처리되는 쿼리는 랜덤 읽기가 상당히 줄어들기 때문에 그만큼 성능이 빨라진다.

이때 리프 노드에 저장된 레코드 주소로 데이터 파일의 레코드를 읽어오는데 레코드 한 건 단위로 랜덤 I/O가 발생하기 때문에 인덱스를 통해 데이터 레코드를 읽는 작업은 비용이 많이 드는 작업으로 분류된다.


<br>

## 8.3.4.2 인덱스 풀 스캔
인덱스의 처음부터 끝까지 모두 읽는 방식을 인덱스 풀 스캔이라고 한다.
- 대표적으로 쿼리의 조건절에 사용된 컬럼이 인덱스의 첫 번째 컬럼이 아닌 경우 사용된다.

![](https://velog.velcdn.com/images/hellojihyoung/post/2a4f7489-ace8-4fd6-b7f0-fe0b6783ffb0/image.png)

- 쿼리가 인덱스에 명시된 컬럼만으로 조건을 처리할 수 있는 경우에 사용된다.
- 디스크 I/O가 적기 때문에 테이블 풀 스캔보다 빠르지만 인덱스 레인지 스캔 보다는 느리다. 
- 인덱스 뿐만 아니라 데이터 레코드까지 모두 읽어야 한다면 이 방식으로 처리되지 않는다. 

<br>

## 루스 인덱스 스캔
루스 인덱스 스캔은 전체 데이터를 읽는 것이 아니라 스캔하는 과정에서 필요하지 않는 인덱스 키값은 무시하고 넘어가는 스캔 방식을 의미한다.       
일반적으로 Group by 또는  max, min 과 같은 집합함수에서 많이 사용된다.  

루스 인덱스 스캔을 사용하기 위한 조건은 10장에 자세히 설명되어 있다.

<br>

## 인덱스 스킵 스캔
인덱스 스킵 스캔은 컬럼 값 정보를 이용해 조건절에 부합하는 레코드를 포함할 '가능성이 있는' 리프 블록만 골라서 액세스하는 스캔 방식이다.       
루스 인덱스 스캔과 비슷한 최적화 기능이지만, 이는 집합 함수에서만 사용할 수 있었다. My SQL 8.0부터 인덱스 스킵 스캔이 도입되면서 사용 범위가 넓어졌다.

인덱스 스킵 스캔은 아래 조건을 만족해야 한다는 단점이 있다.
+ WHERE 조건절에 조건이 없는 인덱스의 선행 컬럼의 유니크한 값의 개수가 적어야 함
+ 쿼리가 인덱스에 존재하는 컬럼만으로 처리 가능해야 함

따라서 인덱스 스킵 스캔은 인덱스의 선행 컬럼이 가진 유니크한 값의 개수가 소량일 때 적용이 가능하다.
