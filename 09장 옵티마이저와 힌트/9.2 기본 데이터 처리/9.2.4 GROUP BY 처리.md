# 9.2.4 GROUP BY 처리
GROUP BY 또한 ORDER BY와 같이 쿼리가 스트리밍된 처리를 할 수 없게 하는 처리 중 하나다.     
GROUP BY 작업도 인덱스를 사용하는 경우와 그렇지 않은 경우로 나눌 수 있다.     
또한 인덱스를 사용하는 경우는 인덱스 스캔 방법과 루스 인덱스 스캔으로 나눌 수 있다.

## 인덱스 스캔을 이용하는 GROUP BY
ORDER BY와 같이 조인의 드라이빙에 속한 칼럼만 이용해 그룹핑할 때, GROUP BY 칼럼으로 이미 인덱스가 있다면 그 인덱스를 차례대로 읽으면서 작업을 수행하고 그 결과로 조인을 수행한다.    
+ GROUP BY가 인덱스를 사용해서 처리된다 해도 그룹함수 등의 그룹값을 처리해야 해서 임시 테이블이 필요할 때도 있다.

## 루스 인덱스 스캔을 이용하는 GROUP BY
루스 인덱스 스캔이란, 인덱스의 레코드를 건너뛰면서 필요한 부분만 읽어서 가져오는 것을 말한다.   
+ 인덱스 레인지 스캔에서는 유니크한 값의 수가 많을수록 성능이 향상되는 반면 루스 인덱스 스캔에서는 인덱스의 유니크한 값의 수가 적을수록 성능이 향상된다.
+ 루스 인덱스 스캔으로 처리되는 쿼리에서는 별도의 임시 테이블이 필요하지 않다.


루스 인덱스 스캔을 사용할 수 없는 쿼리 패턴
```sql
-- // MIN()과 MAX() 이외의 집합 함수가 사용됐기 때문
SELECT col1, SUM(col2) FROM tb_test GROUP BY col1;

-- // GROUP BY에 사용된 칼럼이 인덱스 구성 칼럼의 왼쪽부터 일치하지 않기 때문
SELECT col1, col2 FROM tb_test GROUP BY col2, col3;

-- // SELECT 절의 칼럼이 GROUP BY와 일치하지 않기 때문
SELECT col1, col3 FROM tb_test GROUP BY col1, col2;
```

## 임시 테이블을 사용하는 GROUP BY
인덱스를 전혀 사용하지 못할 때 이 방식으로 처리된다.
+ MySQL 8.0 이전에는 GROUP BY가 사용된 쿼리는 그룹핑되는 칼럼을 기준으로 묵시적인 정렬을 수행했다.
  + 정렬이 필요하지 않은 경우에는 ORDER BY NULL을 사용하도록 권장했다.
+ MySQL 8.0부터는 GROUP BY가 필요한 경우 임시 테이블을 생성하고 중복 제거와 집합 함수 연산을 수행하여 정렬 작업이 필요하지 않다.